---
title: "Introduction to R" 
author: "Author: Daniela Cassol"
date: "Last update: `r format(Sys.time(), '%d %B, %Y')`" 
output:
  html_document:
    toc: true
    toc_float:
        collapsed: true
        smooth_scroll: true
    toc_depth: 3
    fig_caption: yes
    code_folding: show
    number_sections: true
fontsize: 14pt
editor_options: 
  chunk_output_type: console
---

```{r style, echo = FALSE, results = 'asis'}
BiocStyle::markdown()
options(width=100, max.print=1000)
knitr::opts_chunk$set(
    eval=as.logical(Sys.getenv("KNITR_EVAL", "TRUE")),
    cache=as.logical(Sys.getenv("KNITR_CACHE", "TRUE")),
    warning=FALSE, message=FALSE)
```

<!-- rmarkdown::render("index.Rmd", md_document()) -->

# Introduction to R

## RStudio

Some userful shortcuts: `Ctrl+Enter` (send code), `Ctrl+Shift+C`
(comment/uncomment), `Ctrl+1/2` (switch window focus)

Explore [here](https://rstudio.com/wp-content/uploads/2016/01/rstudio-IDE-cheatsheet.pdf) all the RStudio shortcuts

## R Package Repositories

+ CRAN (&gt;11,000 packages) general data analysis -
    [URL](http://cran.at.r-project.org/)
+ Bioconductor (&gt;1,800 packages) bioscience data analysis -
    [URL](http://www.bioconductor.org/)
+ Omegahat (&gt;90 packages) programming interfaces -
    [URL](https://github.com/omegahat?tab=repositories)

## Installation of R Packages

1.  Install R for your operating system from
    [CRAN](http://cran.at.r-project.org/).

2.  Install RStudio from [RStudio](http://www.rstudio.com/ide/download).

3.  Install CRAN Packages from R console like this:

```{r, eval=FALSE}
install.packages(c("pkg1", "pkg2")) 
install.packages("pkg.zip", repos=NULL)
```

4.  Install Bioconductor packages as follows:

```{r, eval=FALSE}
install.packages("BiocManager") 
BiocManager::install("systemPipeR")
```

# Getting Around

## Startup and Closing Behavior

* __Starting R__:
    The R GUI versions, including RStudio, under Windows and Mac OS X can be
    opened by double-clicking their icons. Alternatively, one can start it by
    typing `R` in a terminal (default under Linux). 

* __Startup/Closing Behavior__:
    The R environment is controlled by hidden files in the startup directory:
    `.RData`, `.Rhistory` and `.Rprofile` (optional). 

* __Closing R__:

```{r, eval=FALSE}
q()  
```

```{r, eval=FALSE}
Save workspace image? [y/n/c]: n
```

* __Note__:
    When responding with `y`, then the entire R workspace will be written to
    the `.RData` file which can become very large. Often it is sufficient to just
    save an analysis protocol in an R source file. This way one can quickly
    regenerate all data sets and objects. 

## R Session

After R is started, there is a console awaiting for input. At the prompt (>), you can enter numbers and perform calculations.
```{r, eval=FALSE}
1+4
```

List objects in current R session
```{r, eval=FALSE}
ls()
```

Collect information about the current R session
```{r, eval=FALSE}
sessionInfo()
.libPaths()
```

## Variable Assignment

We assign values to variables with the assignment operator `<-`. Just typing the variable by itself at the prompt will print out the value. We should note that another form of assignment operator `=` is also in use.
```{r, eval=FALSE}
x <- 1
y = 3
x+y
```

## Functions

R functions are invoked by its name, then followed by the parenthesis, and zero or more arguments. The following apply the function c to combine three numeric values into a vector.
```{r, eval=FALSE}
sum(x+y)
log(x+y)
print(x)
```

## Comments

All text after the pound sign "#" within the same line is considered a comment.
```{r, eval=FALSE}
sum(x+y) # This is a comment
```

## Getting Help

R provides extensive documentation. For example, entering `?sum` or `help(sum)` at the prompt gives documentation of the function c in R. Please give it a try.
```{r, eval=FALSE}
help(sum)
?log
```

HomeWork2: Seeking help

## Navigating directories

Return content of current working directory
```{r, eval=FALSE}
dir()
```

Return path of current working directory
```{r, eval=FALSE}
getwd()
```

Change current working directory
```{r, eval=FALSE}
setwd("/home/user")
```

Removing Objects
```{r, eval=FALSE}
rm(y)
ls()
rm(list = ls()) # Removes all objects without warning
```

## Basic Operators and Calculations

+ Comparison operators
  - equal: `==`
  - not equal: `!=`
  - greater/less than: `>` `<`
  - greater/less than or equal: `>=` `<=`

```{r}
1==1
x <- 2
y <- 3
x == y
x != y
```

+ Logical operators
  - AND: `&`
```{r}
x <- 1:10
y <- 10:1 
x > 5 
x > y & x > 5 
```

  - NOT: `!`
```{r}
!x > y
```

## Load a library/package

```{r, eval=FALSE}
library("my_library") 
```

List functions defined by a library
```{r, eval=FALSE}
library(help="my_library")
```

Load library manual (PDF or HTML file)
```{r, eval=FALSE}
vignette("my_library") 
```

Execute an R script from within R
```{r, eval=FALSE}
source("my_script.R")
```

<!-- Note: Vignette X Manual  -->

# Data Types 

*What are Data types in R?*

For correct processing, a programming language must know what can and cannot be done to a particular value. For example, addition cannot be performed on the words *hello* and *world*.

Similarly, you cannot change the numbers `1` and `-34.5` from lower to uppercase. Due to this, R has a feature called the data types. Different kinds of values are assigned different data types that help differentiate them. These types have certain characteristics and rules associated with them that define their properties.

R provides the `class()` and `typeof()` functions to find out what is the class and type of any variable. R has five data types which are:

+ Numeric
+ Characters
+ Integers
+ Complex
+ Logical


Let’s go through these data types one-by-one.

## Numeric data

The numeric data type is for numeric values. It is the default data type for numbers in R.
Example: `1, 2, 3, ...`
```{r, eval=FALSE}
x <- c(1, 2, 3)
x

is.numeric(x)
as.character(x)
class(x) # Prints the object type.
```

## Character data

The character data type stores character values or strings. Strings in R can contain the alphabet, numbers, and symbols. The easiest way to denote that a value is of character type in R is to wrap the value inside single or double inverted commas.
Example: `"a", "b", "c", ...`
```{r, eval=FALSE}
x <- c("1", "2", "3")
x
is.character(x)
as.numeric(x)
```

## Integers data

The Integer data type is used for integer values. To store a value as an integer, we need to specify it as such. The integer data type is commonly used for discrete only values like unique ids. We can store as well as convert a value into an integer type using the as.integer() function.

```{r, eval=FALSE}
int <- as.integer(16)
class(int)
int2 <- as.integer(x)
int2
class(int2)
```

## Complex data

The complex data type is to store numbers with an imaginary component. Examples of complex values would be *1+2i*, *3i*, *4-5i*, *-12+6i*, etc.
Example: mix of both
```{r, eval=FALSE}
y <- c(1, "b", 3)
```

## Logical data

Example: `TRUE` of `FALSE`
```{r, eval=FALSE}
x <- 1:10 < 5
x  
!x
which(x) # Returns index for the 'TRUE' values in logical vector
y <- TRUE
class(y)
```

# Data Objects (Structures)

In any programming language, if you are doing programming, you need to use different variables to store different data. Moreover, variables are reserved in a memory location to store values. Also, this implies that, once you create a variable you reserve some area in memory. Further, data structures are the only way of arranging data so it can be used efficiently on a computer.

If we see in contrast to different programming languages like C and Java, R doesn’t have variables declared as some data type. Further, the variables are appointed with R-objects and the knowledge form of the R-object becomes the datatype of the variable. There are many types of R-objects. The popularly used ones are:

+ Vector
+ Factor
+ Matrix
+ Lists
+ Data Frames

Now, we will discuss each of these R-objects in brief.

## Vectors (1D)

A vector is a sequence of elements that share the same data type. These elements are known as components of a vector.

Definition: `numeric` or `character`
```{r, eval=FALSE}
myVec <- 1:10; names(myVec) <- letters[1:10]  
myVec[1:5]
myVec[c(2,4,6,8)]
myVec[c("b", "d", "f")]

c(TRUE, FALSE, TRUE, FALSE, FALSE) # here is a vector of logical values
length(c("aa", "bb", "cc", "dd", "ee")) # number of elements in a vector is given by the length function
```

## Factors (1D)

R factors are variables. It takes a limited number of different values. Hence, those variables are often known as categorical variables. In order to categorise the data and store it on multiple levels, we use the data object called R factor. They can store both strings and integers. They are also useful in the columns which have a limited number of unique values.

The factor is stored as integers. They have labels associated with these unique integers. We need to be careful while treating factors like strings. Factor contains a predefined set value called levels. By default, R always sorts levels in alphabetical order.

Definition: vectors with grouping information
```{r, eval=FALSE}
factor(c("dog", "cat", "mouse", "dog", "dog", "cat"))
```

## Matrices (2D)

A matrix in R is a two-dimensional rectangular data set and thus it can be created using vector input to the matrix function. R is a tool for expressing statistical and mathematical operations from which beginners will learn how to create and access the R matrix. And, by the end of this article, you will be able to perform addition, subtraction, multiplication, and division operations on R matrices.

Definition: two dimensional structures with data of same type
```{r, eval=FALSE}
myMA <- matrix(1:30, 3, 10, byrow = TRUE) 
class(myMA)
myMA[1:2,]
myMA[1, , drop=FALSE]


```

```{r, eval=FALSE}
mat <- matrix (
c(2 , 4, 3, 1, 5, 7),       # the data elements
nrow =2,                   # no. of rows
ncol =3,                   # no. of columns
byrow = TRUE)
mat
```

## Data Frames (2D)

Definition: two dimensional objects with data of variable types

```{r r_dataframe_object, eval=FALSE}
myDF <- data.frame(Col1=1:10, Col2=10:1) 
myDF[1:2, ]
cbind(myDF, Col3=LETTERS[1:10])
```

## Lists

R list is the object which contains elements of different types – like strings, numbers, vectors and another list inside it. R list can also contain a matrix or a function as its elements. The list is created using the `list()` function in R. In other words, a list is a generic vector containing other objects.

Definition: containers for any object type
```{r, eval=FALSE}
myL <- list(name="Fred", wife="Mary", no.children=3, child.ages=c(4,7,9)) 
myL
myL[[4]][1:2] 
```

## Functions

Definition: piece of code

```{r, eval=FALSE}
myfct <- function(arg1, arg2, ...) { 
	function_body 
}
```

# Subsetting of data objects

__(1.) Subsetting by positive or negative index/position numbers__

```{r, eval=FALSE}
myVec <- 1:26; names(myVec) <- LETTERS 
myVec[1:4]
names(myVec)
```

__(2.) Subsetting by same length logical vectors__

```{r, eval=FALSE}
myLog <- myVec > 10
myVec[myLog] 
```	

__(3.) Subsetting by field names__

```{r, eval=FALSE}
myVec[c("B", "K", "M")]
```

__(4.) Subset with `$` sign__: references a single column or list component by its name 

```{r, eval=FALSE}
iris$Species[1:8]
```

# Important Utilities
	
## Combining Objects
Vectors can be combined via the function c. For examples, the following two vectors n and s are combined into a new vector containing elements from both vectors.

The `c` function combines vectors and lists

```{r, eval=FALSE}
c(1, 2, 3)
x <- 1:3; y <- 101:103
c(x, y)
iris$Species[1:8]
w <- c("a", "b")
c(x, w)
```

*Value Coercion: *

In the code snippet above, notice how the numeric values are being coerced into character strings when the two vectors are combined. This is necessary so as to maintain the same primitive data type for members in the same vector.

The `cbind` and `rbind` functions can be used to append columns and rows, respecively.
```{r, eval=FALSE}
ma <- cbind(x, y)
ma
rbind(ma, ma)
```

## Accessing Dimensions of Objects

Length and dimension information of objects

```{r, eval=FALSE}
length(iris$Species)
dim(iris)
```

## Accessing Name Slots of Objects

Accessing row and column names of 2D objects
```{r, eval=FALSE}
rownames(iris)[1:8]
colnames(iris)
```

Return name field of vectors and lists
```{r, eval=FALSE}
names(myVec)
names(myL)
```

## Sorting Objects

The function `sort` returns a vector in ascending or descending order
```{r, eval=FALSE}
sort(10:1)
```

The function `order` returns a sorting index for sorting an object
```{r, eval=FALSE}
sortindex <- order(iris[,1], decreasing = FALSE)
sortindex[1:12]
iris[sortindex,][1:2,]
sortindex <- order(-iris[,1]) # Same as decreasing=TRUE
```

Sorting multiple columns
```{r, eval=FALSE}
iris[order(iris$Sepal.Length, iris$Sepal.Width),][1:2,]
```

# Operators and Calculations

## Comparison Operators

Comparison operators: `==`, `!=`, `<`, `>`, `<=`, `>=`
```{r, eval=FALSE}
1==1
```

Logical operators: AND: `&`, OR: `|`, NOT: `!`
```{r, eval=FALSE}
x <- 1:10; y <- 10:1
x > y & x > 5
```

## Basic Calculations

Arithmetic operations of vectors are performed element-by-element.

```{r, eval=FALSE}
x + y
sum(x)
mean(x)
apply(iris[1:6,1:3], 1, mean) 
x
2*x
```

To look up math functions, see Function Index [here](http://cran.at.r-project.org/doc/manuals/R-intro.html#Function-and-variable-index)

# Reading and Writing External Data

## Import of tabular data

Import of a tab-delimited tabular file
```{r, eval=FALSE}
myDF <- read.delim("data/example.csv", sep="\t") ## replace "example.csv" for you dataset
myDF <- read.delim("data/example.csv", sep=",") 
## Choose the right separator character "sep" for your data
```

Import of Excel file. Note: working with tab- or comma-delimited files is more flexible and preferred.
```{r, eval=FALSE}
library(gdata)
myDF <- read.xls("data/example.xls")
```

Import of Google Sheets. The following example imports a sample Google Sheet from [here](https://docs.google.com/spreadsheets/d/1U-32UcwZP1k3saKeaH1mbvEAOfZRdNHNkWK2GI1rpPM/edit#gid=472150521).
Detailed instructions for interacting from R with Google Sheets with the required `googlesheets` package are [here](https://github.com/jennybc/googlesheets).

## Export of tabular data
```{r, eval=FALSE}
myDF <- iris[,1:4]
write.table(myDF, file="results/myfile.xls", sep="\t", quote=FALSE, col.names=NA) 
## replace "results/myfile.xls" for "results/myfile_YOURNAME.xls"
```

## Line-wise export
```{r writelines, eval=FALSE}
writeLines(month.name, "results/myData.txt")
```

## Line-wise import
```{r, eval=FALSE}
myDF <- readLines("results/myData.txt")
```

## Export R object
```{r, eval=FALSE}
mylist <- list(C1=iris[,1], C2=iris[,2]) # Example to export
saveRDS(mylist, "results/mylist.rds")
```

## Import R object
```{r readRDSlist, eval=FALSE}
mylist <- readRDS("results/mylist.rds")
```

